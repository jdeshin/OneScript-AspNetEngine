# DataProcessors (Обработки)

## Описание

Библиотека реализует механизм обработок, аналогично платформе 1С:Предприятие.
Библиотека может быть использована только совместно с версией AspNetHandler не ниже 1.2.

## Отличие от 1С:Предприятие

Использование механизма обработок в OneScript синтаксически не отличается от такового в 1С:Предприятия, однако имеются некоторые отличия:

В модуле менеджера, функции ПолучитьФорму и ПолучитьМакет не поддерживаются (пока поддерживается только Создать).
При использовании обработок на основе файлов, все реквизиты/переменные имеют значения неопределено, если они не были инициализированы в модуле объекта.

## Установка

Установка осуществляется копированием файлов dll в папку Bin веб-приложения.
Затем, необходимо внести изменения в секцию ```<appSettings>```, файла web.config:

### 1. Определяем каталог, в котором находятся модули обработок

```bsl
<add key="dataProcessorsPath" value="~/Обработки/" />
```

### 2. Загружаем библиотеку

```bsl
<add key="DataProcessors" value="attachAssembly" />
```

### 3. Регистрируем загрузчик библиотеки

```bsl
<add key="propertiesInjector;DataProcessors;OneScript.HTTPService.DataProcessors" value="" />
```

Где:

__propertiesInspector__ - ключевое слово, говорящее о том, что будут созданы необходимые экземпляры объектов и глобальные свойства,

__DataProcessor__ - имя сборки, содержащей класс, при помощи которого будет происходить инициализация объектов,

__OneScript.HTTPService.DataProcessors__ - тип класса инициализатора

## 4. Если Вы хотите использовать dll-библиотеки компонентов OneScript как обработки, для каждой такой библиотеки добавьте ключ

```bsl
<add key="OneScript.DataProcessor.Demo;OneScript.DataProcessor.Demo;ТестоваяОбработка1" value="attachAsDataProcessor" />
```
Где:

первый параметр до ; - имя сборки,

второй - тип класса библиотеки, который должен иметь реализацию метода Создать,

третий (ТестоваяОбработка1) - имя обработки. Данный параметр не является обязательным и если он отсутствует - именем обработки будет имя типа OneScript (атрибут ContextClass).

## Создание обработок

Поддерживаются обработки двух видов - это обработки на базе текстовых файлов модулей OneScript (*.os), а также компонентов, написанных на c#. 

### Обработки на основе файлов с кодом OneScript *.os

Каждая обработка должна содержать два файла, с примерно следующими названиями:

ИмяОбработки.МодульМенеджера.os
ИмяОбработки.МодульОбъекта.os

Где:

__ИмяОбработки__ - имя Вашей обработки,

__МодульОбъекта__ - сигнализирует о том, что этот файл содержит код, реализующий модуль объекта обработки,

__МодульМенеджера__ - сигнализирует о том, что этот файл содержит код, реализующий модуль менеджера обработки. Реализация стандартных функций менеджера, таких как Создать() не требуется.

Содержимое файлов имеет примерно следующий вид:

```bsl
// Это модуль менеджера обработки: СложитьДваЧисла.МодульМенеджера.os
//
Функция СтатическаяФункция(Число1, Число2) Экспорт
	Возврат Число1 + Число2;
КонецФункции

```

```bsl
// Это модуль объекта обработки: СложитьДваЧисла.МодульОбъекта.os
//
Перем Число1 Экспорт;
Перем Число2 Экспорт;

Функция Сложить(Число3) Экспорт
	Возврат Число1 + Число2 + Число3;
КонецФункции

Число1 = 0;
Число2 = 0;
```


### Обработки на основе внешних компонент OneScript

В качестве обработки может выступать любая dll созданная по технологии внешних компонент OneScript и имеющая классы, реализующие модули менеджера и объекта, а также класс, реализующий загрузку и инициализацию обработки. Класс модуля менеджера должен иметь реализацию функции Создать.

## Использование

```bsl
	Обработка = Обработки.СложитьДваЧисла.Создать();
	Обработка = Обработки.ТестоваяОбработка1.Создать();
	Результат = Обработка.Сложить(2, 3);
	Результат = Обработки.ТестоваяОбработка1.ПолучитьТоЖеСамоеЧисло(Результат);
```