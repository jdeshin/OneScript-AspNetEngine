# DataProcessors (Обработки)

## Описание

Библиотека реализует механизм обработок, аналогично платформе 1С:Предприятие.

## Отличие от 1С:Предприятие

Использование механизма обработок в OneScript синтаксически не отличается от такового в 1С:Предприятия, однако имеются некоторые отличия:

В модуле менеджера, функции ПолучитьФорму.
Функция ПолучитьМакет поддерживает только макеты типов __ТекстовыйДокумент__, __HTML документ__, __ДвоичныеДанные__.
При использовании обработок на основе файлов, все реквизиты/переменные имеют значения неопределено, если они не были инициализированы в модуле объекта.

## Установка

Установка осуществляется копированием файлов dll в папку Bin веб-приложения.
Затем, необходимо внести изменения в секцию ```<appSettings>```, файла web.config:

### 1. Определяем каталог, в котором находятся модули обработок

```bsl
<add key="dataProcessorsPath" value="~/Обработки/" />
```

### 2. Загружаем библиотеку

```bsl
<add key="DataProcessors" value="attachAssembly" />
```

### 3. Регистрируем загрузчик библиотеки

```bsl
<add key="propertiesInjector;DataProcessors;OneScript.HTTPService.DataProcessors" value="" />
```

Где:

__propertiesInspector__ - ключевое слово, говорящее о том, что будут созданы необходимые экземпляры объектов и глобальные свойства,

__DataProcessor__ - имя сборки, содержащей класс, при помощи которого будет происходить инициализация объектов,

__OneScript.HTTPService.DataProcessors__ - тип класса инициализатора

## 4. Если Вы хотите использовать dll-библиотеки компонентов OneScript как обработки, для каждой такой библиотеки добавьте ключ

```bsl
	<!--Пример: Подключение библиотеки как обработки-->
	<add key="OneScript.DataProcessor.Demo" value="attachAssembly" />
	<add key="attachAsDataProcessor;OneScript.DataProcessor.Demo;OneScript.DataProcessor.Demo" value="ПереопределенноеИмяОбработки" />
	<!--Конец подключение библиотеки как обработки-->
```
Где key:
первый параметр должен быть attachAsDataProcessor; - указывает на то, что сборка будет подключена как обработка

второй - Имя сборки, в примере - OneScript.DataProcessor.Demo

третий - имя типа класса библиотеки (в пимере - OneScript.DataProcessor.Demo), Данный класс будет являться классом-менеджером обработки. Класс должен иметь реализацию метода Создать.

value (ПереопределенноеИмяОбработки) - имя обработки. Данный параметр не является обязательным и если он отсутствует - именем обработки будет имя типа OneScript (атрибут ContextClass).

## Создание обработок

Поддерживаются обработки двух видов - это обработки на базе текстовых файлов модулей OneScript (*.os), а также компонентов, написанных на c#. 

### Обработки на основе файлов с кодом OneScript *.os

Каждая обработка должна содержать два файла, с примерно следующими названиями:

ИмяОбработки.МодульМенеджера.os
ИмяОбработки.МодульОбъекта.os

Где:

__ИмяОбработки__ - имя Вашей обработки,

__МодульОбъекта__ - сигнализирует о том, что этот файл содержит код, реализующий модуль объекта обработки,

__МодульМенеджера__ - сигнализирует о том, что этот файл содержит код, реализующий модуль менеджера обработки. Реализация стандартных функций менеджера, таких как Создать() не требуется.

Содержимое файлов имеет примерно следующий вид:

```bsl
// Это модуль менеджера обработки: СложитьДваЧисла.МодульМенеджера.os
//
Функция СтатическаяФункция(Число1, Число2) Экспорт
	Возврат Число1 + Число2;
КонецФункции

```

```bsl
// Это модуль объекта обработки: СложитьДваЧисла.МодульОбъекта.os
//
Перем Число1 Экспорт;
Перем Число2 Экспорт;

Функция Сложить(Число3) Экспорт
	Возврат Число1 + Число2 + Число3;
КонецФункции

Число1 = 0;
Число2 = 0;
```

### Макеты в обработках

Макеты штатно поддерживаются только в обработках на внутреннем языке. Реализацию макетов в обработках на основе внешних компонент необходимо реализовывать в коде внешней компоненты.

В обработках на основе внутреннего языка, файлы макетов хранятся там-же, где и файлы модулей обработок и имеют нижеследующую схему именования файлов: __ИмяОбработки.Макет.ИмяМакета.Расширение__

где: __ИмяОбработки__ - имя обработки на внутреннем языке, __Макет__ - признак того, что это макет, __ИмяМакета__ - имя макета, по которому происходит обращение из внутреннего языка, __Расширение__ - имеет значение txt, для макетов, типа ТекстовыйДокумент, bin, для макетов типа ДвоичныеДанные и html, для макетов типа HTML документ.

### Обработки на основе внешних компонент OneScript

В качестве обработки может выступать любая dll созданная по технологии внешних компонент OneScript и имеющая классы, реализующие модули менеджера и объекта, а также класс, реализующий загрузку и инициализацию обработки. Класс модуля менеджера должен иметь реализацию функции Создать.

## Использование

```bsl
	Обработка = Обработки.СложитьДваЧисла.Создать();
	Обработка = Обработки.ТестоваяОбработка1.Создать();
	Результат = Обработка.Сложить(2, 3);
	Результат = Обработки.ТестоваяОбработка1.ПолучитьТоЖеСамоеЧисло(Результат);
```